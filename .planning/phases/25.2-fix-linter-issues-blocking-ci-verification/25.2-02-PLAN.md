---
phase: 25.2-fix-linter-issues-blocking-ci-verification
plan: 02
type: execute
wave: 2
depends_on: ["25.2-01"]
files_modified:
  - .golangci.yml
  - .planning/ROADMAP.md
  - .planning/STATE.md
autonomous: true

must_haves:
  truths:
    - "make verify passes without lint failures (exit code 0)"
    - "Complexity thresholds at 50 have documented justification comments in .golangci.yml"
    - "CI/CD pipeline verification step would succeed with the updated config"
    - "No new linter issues introduced during fixes"
  artifacts:
    - path: ".golangci.yml"
      provides: "Production-ready linter config with justified thresholds"
      contains: "max-complexity"
    - path: ".planning/ROADMAP.md"
      provides: "Updated phase completion status"
      contains: "25.2"
  key_links:
    - from: ".golangci.yml"
      to: "Makefile lint target"
      via: "make lint invokes golangci-lint run"
      pattern: "golangci-lint run"
---

<objective>
Document complexity threshold justification, run full `make verify`, and update project tracking.

Purpose: The current thresholds of 50 for both gocyclo and cyclop need documented justification (CSI driver complexity from spec compliance + Go error handling). This plan adds that documentation, runs the full CI-equivalent verification, and marks Phase 25.2 complete.

Output: Justified threshold comments in .golangci.yml, `make verify` passing, updated roadmap/state
</objective>

<execution_context>
@/Users/whiskey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/whiskey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25.2-fix-linter-issues-blocking-ci-verification/25.2-01-SUMMARY.md
@.golangci.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Ratchet complexity thresholds with justification</name>
  <files>.golangci.yml</files>
  <action>
Read the current `.golangci.yml` (updated by Plan 01). Keep complexity thresholds at 50 for both gocyclo and cyclop. Add YAML comments documenting the justification:

**What to add (comments only, no threshold changes):**

1. **gocyclo comment:** Threshold 50 is the current baseline. Highest function is ControllerPublishVolume (48). CSI RPC handlers have legitimate complexity from Go's explicit error handling + CSI spec compliance. Ratchet-down plan: refactor highest functions when touched next.

2. **cyclop comment:** Threshold 50 matches gocyclo for consistency. Many functions (ControllerPublishVolume 48, RecordEvent 44, NodeStageVolume 36, NewDriver 33, main 31) are CSI/infrastructure code where complexity comes from spec requirements. Target: ratchet to 30 after refactoring ControllerPublishVolume.

3. **Top offenders list:** Add a comment block listing the top 5 highest-complexity functions for future tracking.

Run `golangci-lint config verify` and `make lint` to confirm config is still valid and passes.
  </action>
  <verify>
Run: `golangci-lint config verify` -- must exit 0
Run: `make lint` -- must exit 0 with 0 issues
  </verify>
  <done>Complexity thresholds documented with justification, `make lint` passes with 0 issues</done>
</task>

<task type="auto">
  <name>Task 2: Run full make verify and update project tracking</name>
  <files>.planning/ROADMAP.md, .planning/STATE.md</files>
  <action>
1. Run `make verify` to confirm ALL verification checks pass (fmt + vet + lint + test). This is the CI-equivalent check.

2. If lint fails: something broke -- investigate and fix before proceeding.

3. Update `.planning/ROADMAP.md`:
   - Change Phase 25.2 plans from `TBD` to `2 plans`
   - Update plan list with actual plan descriptions
   - Mark Phase 25.2 as complete in the progress table

4. Update `.planning/STATE.md`:
   - Update current position
   - Add decisions made (v2 config fix, threshold justification)
   - Update session continuity
   - Note Phase 25.2 complete
  </action>
  <verify>
Run: `make verify` -- check which steps pass/fail
Confirm ROADMAP.md and STATE.md are updated with Phase 25.2 completion
  </verify>
  <done>`make verify` lint step passes (0 lint issues), project tracking updated, Phase 25.2 complete</done>
</task>

</tasks>

<verification>
1. `make verify` completes with lint passing (fmt/vet/lint steps succeed)
2. `.golangci.yml` has justified threshold comments
3. ROADMAP.md shows Phase 25.2 complete
4. STATE.md reflects current position
</verification>

<success_criteria>
- `make verify` lint step exits 0
- Complexity thresholds at 50 documented with justification comments in .golangci.yml
- Phase 25.2 marked complete in project tracking
- CI/CD pipeline would pass lint checks on this codebase
</success_criteria>

<output>
After completion, create `.planning/phases/25.2-fix-linter-issues-blocking-ci-verification/25.2-02-SUMMARY.md`
</output>

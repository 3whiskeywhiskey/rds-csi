---
phase: 18-logging-cleanup
plan: 04
type: execute
wave: 2
depends_on: ["18-02"]
files_modified:
  - pkg/driver/node.go
  - pkg/driver/doc.go
  - pkg/reconciler/orphan_reconciler.go
  - pkg/attachment/reconciler.go
  - pkg/rds/doc.go
autonomous: true

must_haves:
  truths:
    - "All node and reconciler operations follow info=outcome, debug=diagnostic pattern"
    - "V(3) usage eliminated from driver and reconciler packages"
    - "Production logs (V=2) show only actionable information"
    - "Verbosity conventions documented in pkg/driver/doc.go and pkg/rds/doc.go"
  artifacts:
    - path: "pkg/driver/node.go"
      provides: "Rationalized node operation logging"
      contains: "klog.V(4)"
    - path: "pkg/driver/doc.go"
      provides: "Driver package verbosity documentation"
      contains: "V(2)"
    - path: "pkg/rds/doc.go"
      provides: "RDS package verbosity documentation"
      contains: "V(2)"
  key_links:
    - from: "pkg/driver/node.go"
      to: "logging verbosity"
      via: "consistent pattern"
      pattern: "V\\(2\\).*staged|published|V\\(4\\).*device|path"
---

<objective>
Rationalize node.go and reconciler verbosity, complete documentation

Purpose: Apply consistent verbosity rationalization to node driver and reconciler packages. Eliminate V(3) in favor of V(2) (if actionable) or V(4) (if diagnostic). Complete verbosity documentation with pkg/driver/doc.go and pkg/rds/doc.go.

Output:
- Node and reconciler packages follow V(2)=outcome, V(4)=diagnostic pattern
- V(3) eliminated from these packages
- Verbosity conventions documented in all relevant doc.go files
</objective>

<execution_context>
@/Users/whiskey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/whiskey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/18-logging-cleanup/18-CONTEXT.md
@.planning/phases/18-logging-cleanup/18-RESEARCH.md
@.planning/phases/18-logging-cleanup/18-02-SUMMARY.md

# Key source files
@pkg/driver/node.go
@pkg/reconciler/orphan_reconciler.go
@pkg/attachment/reconciler.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rationalize node.go and reconciler verbosity</name>
  <files>pkg/driver/node.go, pkg/reconciler/orphan_reconciler.go, pkg/attachment/reconciler.go, pkg/driver/vmi_grouper.go</files>
  <action>
Audit and rationalize remaining packages:

**pkg/driver/node.go:**
- V(3) "Could not get device path" at line ~433 - move to V(4)
- Review V(2) statements for start/end duplication
- NodeStageVolume: Outcome at V(2), details at V(4)
- NodePublishVolume: Outcome at V(2), bind mount details at V(4)
- NodeUnstageVolume/NodeUnpublishVolume: Same pattern

**pkg/reconciler/orphan_reconciler.go:**
Current (many V(2) and V(3)):
- V(2) "Starting orphan reconciliation cycle" - keep (actionable)
- V(2) "Orphan reconciliation cycle complete" - keep (actionable summary)
- V(2) "No orphaned disk objects found" - move to V(4) (no-op)
- V(2) "No orphaned files found" - move to V(4) (no-op)
- V(2) "Deleting orphaned volume" - keep (actionable)
- V(3) "Scanning %d PersistentVolumes" - move to V(4) (diagnostic)
- V(3) "Found active PV" - move to V(4) (diagnostic)
- V(3) "RDS volume" - move to V(4) (diagnostic)
- V(3) "Checking %d RDS volumes" - move to V(4) (diagnostic)
- V(3) "Orphaned volume too young" - move to V(4) (diagnostic)

**pkg/attachment/reconciler.go:**
- V(3) "Starting attachment reconciliation" - move to V(4) (high frequency, not actionable unless issues)
- V(3) "Node deleted but within grace period" - move to V(4)
- V(3) "Attachment reconciliation complete" - move to V(4) (no stale = no-op)
- V(3) "Cannot get PV" - move to V(4) (edge case diagnostic)

**pkg/driver/vmi_grouper.go:**
- All V(3) statements are diagnostic - move to V(4)
  </action>
  <verify>
Run `go build ./...` to verify compilation.
Count V(3) across target packages:
- `grep -c 'klog.V(3)' pkg/driver/node.go pkg/reconciler/*.go pkg/attachment/*.go` should show 0.
Run `make test` to verify tests pass.
  </verify>
  <done>
Node and reconciler packages follow V(2)=outcome, V(4)=diagnostic.
V(3) eliminated from these packages.
Reconcilers are quiet at V(2) level when no action needed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Document verbosity mapping in pkg/driver/doc.go and pkg/rds/doc.go</name>
  <files>pkg/driver/doc.go, pkg/rds/doc.go</files>
  <action>
Create or update package documentation with verbosity mapping:

Create `pkg/driver/doc.go`:
```go
// Package driver implements CSI Controller and Node services for RDS.
//
// # Logging Verbosity Convention
//
// This package follows Kubernetes logging conventions for verbosity levels:
//
//   - V(0): Always visible - panics, programmer errors
//   - V(1): Configuration, frequently repeating errors
//   - V(2): Production default - operation outcomes, state changes
//     Examples: "Created volume X", "Mounted Y to Z", "Deleted volume X"
//   - V(4): Debug level - intermediate steps, parameters, diagnostics
//     Examples: "Checking attachment state", "Found device path"
//   - V(5): Trace level - command I/O, parsing details
//     Examples: "RouterOS output: ...", "SSH command: ..."
//
// V(3) is avoided in favor of V(2) (if actionable) or V(4) (if diagnostic).
//
// Production deployments use V(2) by default. Set --v=4 for troubleshooting.
package driver
```

Create `pkg/rds/doc.go`:
```go
// Package rds provides SSH client and RouterOS command wrappers for RDS management.
//
// # Logging Verbosity Convention
//
// This package follows Kubernetes logging conventions for verbosity levels:
//
//   - V(0): Always visible - connection failures, critical errors
//   - V(2): Production default - operation outcomes
//     Examples: "Created volume X", "Deleted volume Y", "Resized volume Z"
//   - V(4): Debug level - intermediate steps, command parameters
//     Examples: "Volume already exists", "Checking disk slot"
//   - V(5): Trace level - RouterOS command syntax, raw output
//     Examples: "Executing: /disk add...", "RouterOS response: ..."
//
// V(3) is avoided in favor of V(2) (if actionable) or V(4) (if diagnostic).
//
// Production deployments use V(2) by default. Set --v=4 for troubleshooting.
package rds
```
  </action>
  <verify>
Check doc.go files exist: `ls pkg/driver/doc.go pkg/rds/doc.go`
Run `go doc ./pkg/driver | head -20` to verify documentation visible.
Run `go doc ./pkg/rds | head -20` to verify documentation visible.
  </verify>
  <done>
Verbosity conventions documented in pkg/driver/doc.go and pkg/rds/doc.go.
Future contributors understand V(2) vs V(4) usage across the codebase.
  </done>
</task>

</tasks>

<verification>
1. `make test` passes
2. `grep -rc 'klog.V(3)' pkg/driver/ pkg/reconciler/ pkg/attachment/ | grep -v ':0$' | grep -v '_test.go'` shows minimal/zero results
3. Production logs (V=2) are quiet during normal operation
4. Debug logs (V=4) provide sufficient diagnostic information
5. Verbosity conventions documented in doc.go files for driver, rds, and mount packages
</verification>

<success_criteria>
- V(3) eliminated from driver, reconciler, and attachment packages (except any documented exceptions)
- All packages follow V(2)=outcome, V(4)=diagnostic pattern
- Package documentation explains verbosity conventions in pkg/driver/doc.go, pkg/rds/doc.go, pkg/mount/doc.go
- Info level (V=2) contains only actionable information
</success_criteria>

<output>
After completion, create `.planning/phases/18-logging-cleanup/18-04-SUMMARY.md`
</output>

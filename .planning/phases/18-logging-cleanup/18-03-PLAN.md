---
phase: 18-logging-cleanup
plan: 03
type: execute
wave: 2
depends_on: ["18-02"]
files_modified:
  - pkg/mount/mount.go
  - pkg/mount/health.go
  - pkg/mount/recovery.go
  - pkg/mount/stale.go
  - pkg/mount/procmounts.go
autonomous: true

must_haves:
  truths:
    - "All mount package operations follow info=outcome, debug=diagnostic pattern"
    - "V(3) usage eliminated from mount package"
    - "Production logs (V=2) from mount package show only actionable information"
  artifacts:
    - path: "pkg/mount/mount.go"
      provides: "Rationalized mount operation logging"
      contains: "klog.V(4)"
    - path: "pkg/mount/doc.go"
      provides: "Verbosity convention documentation"
      contains: "V(2)"
  key_links:
    - from: "pkg/mount/mount.go"
      to: "logging verbosity"
      via: "consistent pattern"
      pattern: "V\\(2\\).*mounted|unmounted|formatted|V\\(4\\).*attempt|check|found"
---

<objective>
Rationalize mount package verbosity and document conventions

Purpose: Apply consistent verbosity rationalization to mount package. Eliminate V(3) in favor of V(2) (if actionable) or V(4) (if diagnostic). Document verbosity conventions in pkg/mount/doc.go.

Output:
- Mount package follows V(2)=outcome, V(4)=diagnostic pattern
- V(3) eliminated from mount package
- pkg/mount/doc.go documents verbosity conventions
</objective>

<execution_context>
@/Users/whiskey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/whiskey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/18-logging-cleanup/18-CONTEXT.md
@.planning/phases/18-logging-cleanup/18-RESEARCH.md
@.planning/phases/18-logging-cleanup/18-02-SUMMARY.md

# Key source files
@pkg/mount/mount.go
@pkg/mount/health.go
@pkg/mount/recovery.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rationalize pkg/mount verbosity</name>
  <files>pkg/mount/mount.go, pkg/mount/health.go, pkg/mount/recovery.go, pkg/mount/stale.go, pkg/mount/procmounts.go</files>
  <action>
Audit and rationalize mount package verbosity:

**pkg/mount/mount.go (~25 V(2) statements):**
Current pattern logs both start and success for each operation.

Apply rationalization:
- Mount(): Remove start log, keep success at V(2). Details at V(4).
  - Current: V(2) "Mounting %s to %s" + V(2) "Successfully mounted"
  - Target: V(2) "Mounted %s to %s" (outcome only)

- Unmount(): Same pattern - outcome only at V(2)
  - Keep V(2) "path is not mounted, nothing to unmount" (actionable)

- FormatAndMount(): Outcome at V(2), "device already formatted" at V(4) (no-op)

- ResizeFs(): Outcome at V(2), intermediate steps at V(4)

- ForceUnmount(): Outcome at V(2), retry attempts at V(4)

**pkg/mount/health.go:**
- Keep V(2) "Skipping health check for unsupported filesystem" (actionable info)
- Move V(3) "health check passed" to V(4) (diagnostic)

**pkg/mount/recovery.go:**
- All V(3) statements are retry/step logs - move to V(4)
- Keep final outcome (success/failure) at V(2) if not already

**pkg/mount/stale.go:**
- V(3) "mount not stale" - move to V(4) (diagnostic)
- V(3) "mount not found" - move to V(4)

**pkg/mount/procmounts.go:**
- V(3) "Found mount device" - move to V(4) (diagnostic lookup)
  </action>
  <verify>
Run `go build ./...` to verify compilation.
Count V(3) in mount package: `grep -rc 'klog.V(3)' pkg/mount/` should show 0.
Run `make test` to verify tests pass.
  </verify>
  <done>
Mount package V(3) eliminated - all moved to V(4).
V(2) logs show outcomes only (mounted, unmounted, formatted).
V(4) logs show diagnostic steps (retries, lookups, checks).
  </done>
</task>

<task type="auto">
  <name>Task 2: Document verbosity mapping in pkg/mount/doc.go</name>
  <files>pkg/mount/doc.go</files>
  <action>
Create package documentation with verbosity mapping:

Create `pkg/mount/doc.go`:
```go
// Package mount provides filesystem mount/unmount operations for CSI node service.
//
// # Logging Verbosity Convention
//
// This package follows Kubernetes logging conventions for verbosity levels:
//
//   - V(0): Always visible - programmer errors, panics
//   - V(2): Production default - operation outcomes, state changes
//     Examples: "Mounted /dev/nvme0n1 to /var/lib/kubelet/...", "Unmounted /path"
//   - V(4): Debug level - intermediate steps, parameters, diagnostics
//     Examples: "Checking if path is mounted", "Retrying mount (attempt 2/3)"
//   - V(5): Trace level - command output, parsing details
//
// V(3) is avoided in favor of V(2) (if actionable) or V(4) (if diagnostic).
//
// Production deployments use V(2) by default. Set --v=4 for troubleshooting.
package mount
```
  </action>
  <verify>
Check doc.go exists: `ls pkg/mount/doc.go`
Run `go doc ./pkg/mount | head -20` to verify documentation visible.
  </verify>
  <done>
Verbosity conventions documented in pkg/mount/doc.go.
Future contributors understand V(2) vs V(4) usage for mount operations.
  </done>
</task>

</tasks>

<verification>
1. `make test` passes
2. `grep -rc 'klog.V(3)' pkg/mount/ | grep -v ':0$'` shows empty (no V(3) in mount package)
3. Production logs (V=2) are quiet during normal mount/unmount operations
4. Debug logs (V=4) provide sufficient diagnostic information for mount troubleshooting
5. pkg/mount/doc.go exists and documents verbosity conventions
</verification>

<success_criteria>
- V(3) eliminated from mount package production code
- Mount package follows V(2)=outcome, V(4)=diagnostic pattern
- Package documentation explains verbosity conventions
- Info level (V=2) contains only actionable information for mount operations
</success_criteria>

<output>
After completion, create `.planning/phases/18-logging-cleanup/18-03-SUMMARY.md`
</output>

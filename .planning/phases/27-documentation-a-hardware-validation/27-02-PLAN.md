---
phase: 27-documentation-a-hardware-validation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/CAPABILITIES.md
  - README.md
autonomous: true

must_haves:
  truths:
    - "Operator can see which CSI capabilities RDS CSI supports vs AWS EBS CSI and Longhorn"
    - "Operator understands known limitations before deploying (RouterOS version, NVMe timing, dual-IP)"
    - "Honest assessment of gaps without being defensive -- explains 'why not' for missing features"
    - "Known limitations include detection methods and workarounds"
  artifacts:
    - path: "docs/CAPABILITIES.md"
      provides: "CSI capability gap analysis with feature comparison matrix"
      min_lines: 200
      contains: "AWS EBS"
    - path: "README.md"
      provides: "Known Limitations section with version-specific constraints"
      contains: "Known Limitations"
  key_links:
    - from: "docs/CAPABILITIES.md"
      to: "docs/TESTING.md"
      via: "cross-reference for tested vs untested capabilities"
      pattern: "TESTING.md"
    - from: "README.md"
      to: "docs/CAPABILITIES.md"
      via: "link for full comparison"
      pattern: "CAPABILITIES.md"
---

<objective>
Create CSI capability gap analysis (CAPABILITIES.md) comparing RDS CSI against peer drivers, and add consolidated Known Limitations section to README.md.

Purpose: Operators evaluating RDS CSI need honest, structured comparison against mature drivers to set correct expectations. Known limitations must be specific enough (with version numbers, detection methods, workarounds) to guide deployment decisions. Satisfies DOC-03 (capability gap analysis) and DOC-04 (known limitations).

Output: docs/CAPABILITIES.md with feature matrix and gap analysis; README.md updated with Known Limitations section.
</objective>

<execution_context>
@/Users/whiskey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/whiskey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@docs/TESTING.md
@docs/architecture.md
@README.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CAPABILITIES.md with feature comparison matrix</name>
  <files>docs/CAPABILITIES.md</files>
  <action>
Create docs/CAPABILITIES.md following Pattern 3 from 27-RESEARCH.md (Capability Gap Analysis Framework).

**Document Structure:**

1. **Header and Overview:**
   - Driver maturity: v0.9.0, production-tested on homelab cluster with KubeVirt workloads
   - Target use case: Single-server NVMe/TCP storage for Kubernetes on MikroTik ROSE Data Server
   - Not competing with distributed storage solutions -- different architectural goals

2. **CSI Specification Coverage (3 tables):**

   **Identity Service:**
   | Capability | Status | Notes |
   | CONTROLLER_SERVICE | Supported | |
   | VOLUME_ACCESSIBILITY_CONSTRAINTS | Supported | Topology-aware scheduling |

   **Controller Service:**
   | Capability | Status | Notes |
   | CREATE_DELETE_VOLUME | Supported | SSH-based, file-backed on Btrfs |
   | PUBLISH_UNPUBLISH_VOLUME | Supported | VolumeAttachment tracking |
   | LIST_VOLUMES | Supported | |
   | GET_CAPACITY | Supported | Btrfs pool capacity |
   | EXPAND_VOLUME | Supported | Online expansion, automatic node detection |
   | CREATE_DELETE_SNAPSHOT | Planned (v0.10.0) | Phase 26 - Btrfs snapshots |
   | LIST_SNAPSHOTS | Planned (v0.10.0) | Phase 26 |
   | CLONE_VOLUME | Not Planned | Would require Btrfs reflink support in RouterOS |
   | GET_VOLUME | Not Implemented | Optional per CSI spec |

   **Node Service:**
   | Capability | Status | Notes |
   | STAGE_UNSTAGE_VOLUME | Supported | NVMe/TCP connect, format, mount |
   | EXPAND_VOLUME | Supported | Kernel auto-detects block device resize |
   | GET_VOLUME_STATS | Supported | Real filesystem stats |
   | VOLUME_CONDITION | Supported | NVMe health checks |
   | SINGLE_NODE_MULTI_WRITER | Not Supported | ReadWriteOnce only |

3. **Feature Comparison Matrix:**

   Create a detailed comparison table with these columns: Feature | RDS CSI | AWS EBS CSI | Longhorn

   Features to compare:
   - Dynamic provisioning: All supported
   - Volume expansion: All supported (note RDS uses online expansion)
   - Snapshots: RDS planned, others supported
   - Volume cloning: RDS not planned, EBS supported, Longhorn supported
   - Topology awareness: RDS basic (single server), EBS AZ-based, Longhorn node-based
   - Access modes: RDS RWO only, EBS RWO + RWX (multi-attach), Longhorn RWO + RWX (NFS)
   - Block volume mode: All supported
   - Volume encryption: RDS not supported, others supported
   - High availability: RDS single controller, EBS managed, Longhorn replicated
   - Multipath: RDS not applicable (single server), EBS EBS-optimized, Longhorn built-in
   - Health monitoring: RDS VolumeCondition, EBS limited, Longhorn comprehensive
   - Reconnection resilience: RDS comprehensive (ctrl_loss_tmo, auto-reconnect), EBS managed, Longhorn built-in
   - KubeVirt support: RDS validated, EBS not typically used, Longhorn validated
   - Live migration: RDS validated, Longhorn supported

4. **Unique Advantages (RDS CSI):**
   - NVMe/TCP protocol: Lower latency (~1ms) than iSCSI-based drivers (~3ms)
   - File-backed volumes: Flexible sizing on Btrfs RAID
   - SSH management: Secure, debuggable, auditable
   - Attachment reconciliation: Auto-recovery from stale VolumeAttachment state
   - NVMe-oF reconnection: Comprehensive handling of controller renumbering
   - Production-tested KubeVirt integration with live migration

5. **Architectural Differences:**
   - Explain RDS is single-server (not distributed) -- different reliability model
   - NVMe/TCP vs iSCSI vs cloud API -- protocol differences matter
   - SSH CLI vs REST API vs cloud SDK -- management approach
   - Why comparing "HA" is apples-to-oranges (RDS targets homelab/small cluster)

6. **What's Not Supported and Why:**
   - Volume cloning: RouterOS doesn't expose Btrfs reflink via CLI (architectural constraint)
   - Multi-attach/RWX: NVMe/TCP namespaces are single-initiator (protocol limitation)
   - Controller HA: Single RDS server means HA adds complexity without improving storage reliability
   - Encryption: Separate security concern, would need RouterOS-level implementation
   - Multipath: Single storage endpoint (not applicable to architecture)

7. **Roadmap / Future Features:**
   - Snapshots (v0.10.0, Phase 26)
   - Helm chart (v0.10.0, Phase 28)
   - RouterOS API support (planned, would improve performance)
   - Link to ROADMAP.md for current status

**Style Notes:**
- Be honest about gaps -- operators appreciate transparency over marketing
- Use checkmark/cross/planned icons for quick scanning
- Explain "why not" for every missing feature
- Don't compare distributed storage HA against single-server -- acknowledge the architectural difference
- Include version numbers (v0.9.0 for current, v0.10.0 for planned)
  </action>
  <verify>
Run: `wc -l docs/CAPABILITIES.md` - should be 200+ lines.
Run: `grep -c "AWS EBS" docs/CAPABILITIES.md` - should be 5+ mentions.
Run: `grep -c "Longhorn" docs/CAPABILITIES.md` - should be 5+ mentions.
Run: `grep "Not Planned\|Not Supported\|Planned" docs/CAPABILITIES.md | head -10` - should show honest gap assessment.
Run: `grep "Why\|why" docs/CAPABILITIES.md | head -5` - should show "why not" explanations.
  </verify>
  <done>
CAPABILITIES.md exists with CSI spec coverage tables, feature comparison matrix (RDS CSI vs AWS EBS CSI vs Longhorn), unique advantages section, architectural differences explanation, and honest "why not" for every missing feature.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Known Limitations section to README.md</name>
  <files>README.md</files>
  <action>
Add a "Known Limitations" section to README.md. Place it AFTER the "Configuration" section and BEFORE the "Kubernetes Deployment" section (approximately after line 214).

Follow Pattern 4 from 27-RESEARCH.md (Known Limitations Documentation) -- specific constraints with version numbers and workarounds.

**Known Limitations section content:**

```markdown
## Known Limitations

### RouterOS Version Compatibility
**Requires:** RouterOS 7.1+ with ROSE Data Server feature enabled
**Impact:** Cannot deploy on RouterOS 6.x, CHR (Cloud Hosted Router), or non-RDS RouterOS
**Detection:** Controller logs "SSH connection failed" or unexpected command output
**Workaround:** Ensure RDS hardware with RouterOS 7.16+ for full feature support

### NVMe Device Timing Assumptions
**Requires:** NVMe block device appears within 30 seconds of `nvme connect`
**Impact:** On congested networks or heavily loaded RDS, NodeStageVolume may timeout
**Detection:** Node plugin logs "timeout waiting for NVMe device" or pod stuck in ContainerCreating
**Workaround:** Check network latency to RDS storage IP; restart node plugin pod if transient

### Dual-IP Architecture
**Recommended:** Separate management (SSH) and storage (NVMe/TCP) network interfaces
**Impact:** Single-IP deployments work but SSH management traffic shares bandwidth with storage I/O
**Detection:** Higher than expected I/O latency; management operations slow during heavy I/O
**Workaround:** Configure `nvmeAddress` in StorageClass to use dedicated storage interface. Management via `rdsAddress` can use lower-bandwidth interface.

### Single Controller Instance
**Design:** One controller replica (no HA leader election)
**Impact:** Brief volume provisioning unavailability during controller pod restarts (~10s)
**Detection:** PVC stuck Pending during controller restart
**Workaround:** Existing volumes remain accessible; only new provisioning/deletion is affected during restart

### Access Mode Restrictions
**Supported:** ReadWriteOnce (RWO) only
**Impact:** Cannot mount a volume on multiple nodes simultaneously
**Detection:** PVC with ReadWriteMany will fail to provision
**Workaround:** Use one PVC per pod; for shared storage needs, consider alternative solutions

### Volume Size Minimum
**Minimum:** Volume size must be at least 1 GiB
**Impact:** Requests below 1 GiB will be rounded up by the driver
**Detection:** Created volume size may differ from requested size for sub-1GiB requests

For a comprehensive comparison with other CSI drivers, see [Capabilities Analysis](docs/CAPABILITIES.md).
```

Also add a link to CAPABILITIES.md in the Documentation section:
```
- **[Capabilities & Comparison](docs/CAPABILITIES.md)** - Feature comparison with AWS EBS CSI and Longhorn
```

Place this after the Hardware Validation Guide link (which Plan 01 adds) or after the Kubernetes Setup Guide link if Plan 01 hasn't run yet. Check what exists and add after the last documentation link that starts with "**[".
  </action>
  <verify>
Run: `grep -A 30 "## Known Limitations" README.md | head -35` - should show structured limitations.
Run: `grep "CAPABILITIES.md" README.md` - should show link in Documentation section.
Run: `grep -c "Detection:" README.md` - should be 5+ (one per limitation).
Run: `grep -c "Workaround:" README.md` - should be 5+ (one per limitation).
  </verify>
  <done>
README.md has a Known Limitations section with 6 specific limitations, each having requires/impact/detection/workaround fields. Documentation section links to CAPABILITIES.md.
  </done>
</task>

</tasks>

<verification>
- docs/CAPABILITIES.md exists with feature comparison matrix against AWS EBS CSI and Longhorn
- CSI specification coverage tables cover Identity, Controller, and Node services
- Every "Not Supported" or "Not Planned" feature has a "why not" explanation
- README.md has Known Limitations section with version-specific constraints
- Each limitation has detection method and workaround
- Cross-references between CAPABILITIES.md, README.md, and TESTING.md
</verification>

<success_criteria>
An operator evaluating RDS CSI can quickly understand what it supports, what it doesn't, and why. Known limitations are specific enough to prevent deployment surprises. The gap analysis is honest and frames architectural differences fairly (single-server vs distributed).
</success_criteria>

<output>
After completion, create `.planning/phases/27-documentation-a-hardware-validation/27-02-SUMMARY.md`
</output>

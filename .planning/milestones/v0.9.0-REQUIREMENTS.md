# Requirements Archive: v0.9.0 Production Readiness & Test Maturity

**Archived:** 2026-02-06
**Status:** ✅ SHIPPED

This is the archived requirements specification for v0.9.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: RDS CSI Driver v0.9.0

**Defined:** 2026-02-04
**Core Value:** Volumes remain accessible after NVMe-oF reconnections

## v0.9.0 Requirements

### CSI Compliance (COMP)

- [x] **COMP-01**: CSI sanity test suite runs without failures in CI
- [x] **COMP-02**: All controller service methods pass idempotency validation
- [x] **COMP-03**: All node service methods pass idempotency validation
- [x] **COMP-04**: CreateVolume/DeleteVolume idempotency with volume ID collisions tested
- [x] **COMP-05**: Negative test cases validate proper error codes (ALREADY_EXISTS, NOT_FOUND, etc.)
- [x] **COMP-06**: CSI spec compliance matrix documented showing implemented vs optional capabilities

### Mock Infrastructure (MOCK)

- [x] **MOCK-01**: Mock RDS server supports all volume lifecycle commands (/disk add, /disk remove)
- [x] **MOCK-02**: Mock RDS server supports capacity queries (/file print detail)
- [x] **MOCK-03**: Mock server simulates realistic SSH latency (200ms average)
- [x] **MOCK-04**: Mock server supports error injection (disk full, SSH timeout, command failures)
- [x] **MOCK-05**: Mock server maintains stateful volume tracking across operations
- [x] **MOCK-06**: Mock server returns RouterOS-formatted output matching production format
- [x] **MOCK-07**: Mock server supports concurrent SSH connections for stress testing

### E2E Testing (E2E)

- [x] **E2E-01**: Automated volume lifecycle test (create → stage → publish → unpublish → unstage → delete)
- [x] **E2E-02**: Automated block volume lifecycle test with KubeVirt VirtualMachineInstance
- [x] **E2E-03**: Volume expansion test validates filesystem resize
- [x] **E2E-04**: Multi-volume test validates concurrent operations
- [x] **E2E-05**: Cleanup test validates orphan detection and reconciliation
- [x] **E2E-06**: Node failure simulation test validates volume unstaging on node deletion
- [x] **E2E-07**: Controller restart test validates state rebuild from VolumeAttachment objects
- [x] **E2E-08**: E2E tests run in CI against mock RDS without real hardware
- [x] **E2E-09**: E2E test cleanup prevents orphaned resources between test runs

### Coverage & Quality (COV)

- [x] **COV-01**: Error paths in controller service have test coverage
- [x] **COV-02**: Error paths in node service have test coverage
- [x] **COV-03**: Edge cases from sanity test failures have regression tests
- [x] **COV-04**: Negative test scenarios validate error handling (invalid parameters, missing volumes)
- [x] **COV-05**: Coverage enforcement in CI prevents regression below 65% baseline
- [x] **COV-06**: Flaky tests identified and fixed or skipped with documented rationale

### Attachment Reconciliation & RDS Resilience (RECON) - Phase 25.1 INSERTED

- [x] **RECON-01**: Controller reconciliation loop detects stale VolumeAttachment objects on startup
- [x] **RECON-02**: Stale attachments automatically marked as detached
- [x] **RECON-03**: Node NotReady watcher triggers proactive attachment validation
- [x] **RECON-04**: RDS connection loss triggers automatic reconnect with exponential backoff
- [x] **RECON-05**: CSI Probe health check returns ready=false when RDS disconnected
- [x] **RECON-06**: After RDS reconnection, controller triggers attachment reconciliation

### Linter & Code Quality (LINT) - Phase 25.2 INSERTED

- [x] **LINT-01**: All 63 errcheck issues resolved
- [x] **LINT-02**: All cyclomatic complexity issues resolved or justified (threshold 50)
- [x] **LINT-03**: All staticcheck issues resolved (error strings, dot imports, etc.)

## Requirements Moved to v0.10.0

### Volume Snapshots (SNAP) - Phase 26

- [ ] **SNAP-01**: CreateSnapshot capability advertised in controller service
- [ ] **SNAP-02**: CreateSnapshot creates Btrfs snapshot via SSH/RouterOS
- [ ] **SNAP-03**: CreateSnapshot stores snapshot metadata in VolumeSnapshotContent
- [ ] **SNAP-04**: DeleteSnapshot removes Btrfs snapshot and cleans up metadata
- [ ] **SNAP-05**: ListSnapshots returns existing snapshots via RouterOS query
- [ ] **SNAP-06**: CreateVolume from snapshot (restore) creates new volume from Btrfs snapshot
- [ ] **SNAP-07**: Snapshot operations pass CSI sanity snapshot tests
- [ ] **SNAP-08**: external-snapshotter sidecar integrated in controller deployment
- [ ] **SNAP-09**: VolumeSnapshotClass StorageClass parameter support
- [ ] **SNAP-10**: Snapshot size and creation timestamp tracked in metadata

### Documentation & Validation (DOC) - Phase 27

- [ ] **DOC-01**: Manual test scenarios documented for hardware validation
- [ ] **DOC-02**: Testing guide for contributors (unit, integration, E2E, sanity)
- [ ] **DOC-03**: CSI capability gap analysis vs peer drivers documented
- [ ] **DOC-04**: Known limitations documented (RouterOS version compatibility, timing assumptions)
- [ ] **DOC-05**: CI/CD integration guide for test automation
- [ ] **DOC-06**: Troubleshooting guide for common test failures
- [ ] **DOC-07**: Snapshot usage guide with examples and best practices

## Traceability

**Coverage:**
- v0.9.0 requirements shipped: 32/32 (100%)
- v0.9.0 requirements deferred to v0.10.0: 17 (SNAP + DOC)
- Total v0.9.0 requirements completed: 32

| Requirement | Phase | Status |
|-------------|-------|--------|
| COMP-01 | Phase 22 | ✅ Complete |
| COMP-02 | Phase 22 | ✅ Complete |
| COMP-03 | Phase 22 | ✅ Complete |
| COMP-04 | Phase 22 | ✅ Complete |
| COMP-05 | Phase 22 | ✅ Complete |
| COMP-06 | Phase 22 | ✅ Complete |
| MOCK-01 | Phase 23 | ✅ Complete |
| MOCK-02 | Phase 23 | ✅ Complete |
| MOCK-03 | Phase 23 | ✅ Complete |
| MOCK-04 | Phase 23 | ✅ Complete |
| MOCK-05 | Phase 23 | ✅ Complete |
| MOCK-06 | Phase 23 | ✅ Complete |
| MOCK-07 | Phase 23 | ✅ Complete |
| E2E-01 | Phase 24 | ✅ Complete |
| E2E-02 | Phase 24 | ✅ Complete |
| E2E-03 | Phase 24 | ✅ Complete |
| E2E-04 | Phase 24 | ✅ Complete |
| E2E-05 | Phase 24 | ✅ Complete |
| E2E-06 | Phase 24 | ✅ Complete |
| E2E-07 | Phase 24 | ✅ Complete |
| E2E-08 | Phase 24 | ✅ Complete |
| E2E-09 | Phase 24 | ✅ Complete |
| COV-01 | Phase 25 | ✅ Complete |
| COV-02 | Phase 25 | ✅ Complete |
| COV-03 | Phase 25 | ✅ Complete |
| COV-04 | Phase 25 | ✅ Complete |
| COV-05 | Phase 25 | ✅ Complete |
| COV-06 | Phase 25 | ✅ Complete |
| RECON-01 | Phase 25.1 | ✅ Complete |
| RECON-02 | Phase 25.1 | ✅ Complete |
| RECON-03 | Phase 25.1 | ✅ Complete |
| RECON-04 | Phase 25.1 | ✅ Complete |
| RECON-05 | Phase 25.1 | ✅ Complete |
| RECON-06 | Phase 25.1 | ✅ Complete |
| LINT-01 | Phase 25.2 | ✅ Complete |
| LINT-02 | Phase 25.2 | ✅ Complete |
| LINT-03 | Phase 25.2 | ✅ Complete |

---

## Milestone Summary

**Shipped:** 32 of 32 v0.9.0 requirements (100%)

**Adjusted Requirements:**
- Phase 25.1 requirements (RECON-01 through RECON-06) were added during milestone execution in response to production incident
- Phase 25.2 requirements (LINT-01 through LINT-03) were added during milestone execution to unblock CI/CD pipeline

**Deferred Requirements:**
- SNAP-01 through SNAP-10 (Volume Snapshots) moved to v0.10.0
- DOC-01 through DOC-07 (Documentation & Hardware Validation) moved to v0.10.0

**Rationale for deferrals:**
- v0.9.0 accomplished its core mission: production-ready testing infrastructure and resilience features
- Snapshots and comprehensive documentation are feature enhancements better suited for v0.10.0
- Allows v0.9.0 to be released with a clean, focused scope

---
*Archived: 2026-02-06 as part of v0.9.0 milestone completion*

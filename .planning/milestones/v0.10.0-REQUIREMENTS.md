# Requirements: RDS CSI Driver v0.10.0

**Defined:** 2026-02-04
**Shipped:** 2026-02-06
**Core Value:** Volume snapshots enable backup and restore workflows

## v0.10.0 Requirements

### Volume Snapshots (SNAP)

- [x] **SNAP-01**: CreateSnapshot capability advertised in controller service
- [x] **SNAP-02**: CreateSnapshot creates Btrfs snapshot via SSH/RouterOS
- [x] **SNAP-03**: CreateSnapshot stores snapshot metadata in VolumeSnapshotContent
- [x] **SNAP-04**: DeleteSnapshot removes Btrfs snapshot and cleans up metadata
- [x] **SNAP-05**: ListSnapshots returns existing snapshots via RouterOS query
- [x] **SNAP-06**: CreateVolume from snapshot (restore) creates new volume from Btrfs snapshot
- [x] **SNAP-07**: Snapshot operations pass CSI sanity snapshot tests
- [x] **SNAP-08**: external-snapshotter sidecar integrated in controller deployment
- [x] **SNAP-09**: VolumeSnapshotClass StorageClass parameter support
- [x] **SNAP-10**: Snapshot size and creation timestamp tracked in metadata

### Documentation & Validation (DOC)

- [x] **DOC-01**: Manual test scenarios documented for hardware validation
- [x] **DOC-02**: Testing guide for contributors (unit, integration, E2E, sanity)
- [x] **DOC-03**: CSI capability gap analysis vs peer drivers documented
- [x] **DOC-04**: Known limitations documented (RouterOS version compatibility, timing assumptions)
- [x] **DOC-05**: CI/CD integration guide for test automation
- [x] **DOC-06**: Troubleshooting guide for common test failures
- [x] **DOC-07**: Snapshot usage guide with examples and best practices *(added via tech debt cleanup)*

### Metric Accuracy (METRIC)

- [x] **METRIC-01**: rds_csi_nvme_connections_active gauge reports actual connection count from attachment manager state

### RDS Monitoring (MON)

- [x] **MON-01**: RouterOS /disk monitor-traffic command capabilities documented
- [x] **MON-02**: Monitoring approach recommendations documented (SSH polling vs SNMP vs API)
- [x] **MON-03**: Prometheus metric naming conventions defined (rds_disk_* namespace)

### Helm Chart (HELM)

- [x] **HELM-01**: Helm chart structure and metadata (Chart.yaml, version 1.0.0)
- [x] **HELM-02**: Configurable RDS connection parameters (address, SSH port, NVMe port)
- [x] **HELM-03**: Multiple StorageClasses with different configurations
- [x] **HELM-04**: Monitoring integration (Service, ServiceMonitor with CRD detection)
- [x] **HELM-05**: Documentation and distribution (README, NOTES.txt, git-based)

## Requirement Outcomes

All 25 v0.10.0 requirements were satisfied during milestone execution:

### Validated During Development

- **SNAP-01 through SNAP-10** (10 requirements): All snapshot functionality implemented and verified via CSI sanity tests, controller unit tests (21 test cases), and E2E tests (6 test scenarios). external-snapshotter v8.2.0 sidecar integrated.

- **DOC-01 through DOC-06** (6 requirements): Comprehensive documentation delivered:
  - HARDWARE_VALIDATION.md: 1565 lines, 7 test cases
  - TESTING.md: 530 lines, all test types with troubleshooting
  - CAPABILITIES.md: 357 lines, peer driver comparison
  - ci-cd.md: 413 lines, job templates and result interpretation
  - README.md: Known limitations section added

- **DOC-07**: Initially deferred to post-Phase 26, then added via tech debt cleanup before milestone completion (TC-08 in HARDWARE_VALIDATION.md with 290 lines of snapshot test procedures).

- **METRIC-01** (1 requirement): Production bug fix implemented in Phase 28.1. Replaced counter-derived gauge with GaugeFunc querying AttachmentManager. Unit tests verify metric accuracy across controller restarts.

- **MON-01 through MON-03** (3 requirements): RDS health monitoring research completed in Phase 28.2. SSH polling approach documented with Prometheus metric integration. Implementation deferred to future milestone based on production feedback.

- **HELM-01 through HELM-05** (5 requirements): Complete Helm chart delivered in Phase 28:
  - Chart.yaml: apiVersion v2, version 1.0.0, appVersion 0.10.0
  - values.yaml: 328 lines with comprehensive defaults
  - values.schema.json: 211 lines with validation
  - 13 template files: 1197 total lines
  - README.md: 625 lines documenting all configuration
  - NOTES.txt: 184 lines with post-install validation
  - helm lint: 1 chart linted, 0 failed
  - helm template: 12 resources rendered successfully

### Adjusted During Execution

None. All requirements remained stable throughout milestone execution.

### Dropped

None. All 25 requirements were satisfied.

## Coverage Analysis

**Requirements Coverage:**
- Total v0.10.0 requirements: 25
- Mapped to phases: 25/25 (100%)
- Unmapped: 0
- Satisfied: 25/25 (100%)

**Phase Coverage:**
- Phase 26 (Volume Snapshots): SNAP-01 through SNAP-10 (10 requirements)
- Phase 27 (Documentation): DOC-01 through DOC-07 (7 requirements)
- Phase 28.1 (Metric Accuracy): METRIC-01 (1 requirement)
- Phase 28.2 (RDS Monitoring): MON-01 through MON-03 (3 requirements)
- Phase 28 (Helm Chart): HELM-01 through HELM-05 (5 requirements)

## Traceability Table

| Requirement | Phase | Status | Evidence |
|-------------|-------|--------|----------|
| SNAP-01 | Phase 26 | ✅ Complete | pkg/driver/driver.go:361 |
| SNAP-02 | Phase 26 | ✅ Complete | pkg/driver/controller.go:984-1075, pkg/rds/commands.go:740-770 |
| SNAP-03 | Phase 26 | ✅ Complete | controller.go:1066-1074 response fields |
| SNAP-04 | Phase 26 | ✅ Complete | controller.go:1078-1108, commands.go:775-805 |
| SNAP-05 | Phase 26 | ✅ Complete | controller.go:1111-1186, commands.go:836-870 |
| SNAP-06 | Phase 26 | ✅ Complete | controller.go:150-152, 254-356, commands.go:887-930 |
| SNAP-07 | Phase 26 | ✅ Complete | test/sanity/sanity_test.go:204, 65/70 tests pass |
| SNAP-08 | Phase 26 | ✅ Complete | deploy/kubernetes/controller.yaml:222-242 |
| SNAP-09 | Phase 26 | ✅ Complete | deploy/kubernetes/snapshotclass.yaml |
| SNAP-10 | Phase 26 | ✅ Complete | SnapshotInfo type with 6 fields, pkg/rds/types.go:56-63 |
| DOC-01 | Phase 27 | ✅ Complete | docs/HARDWARE_VALIDATION.md (1565 lines, 7 test cases) |
| DOC-02 | Phase 27 | ✅ Complete | docs/TESTING.md (530 lines) |
| DOC-03 | Phase 27 | ✅ Complete | docs/CAPABILITIES.md (357 lines) |
| DOC-04 | Phase 27 | ✅ Complete | README.md Known Limitations section |
| DOC-05 | Phase 27 | ✅ Complete | docs/ci-cd.md (413 lines) |
| DOC-06 | Phase 27 | ✅ Complete | docs/TESTING.md troubleshooting sections |
| DOC-07 | Phase 27 | ✅ Complete | TC-08 in HARDWARE_VALIDATION.md (290 lines) |
| METRIC-01 | Phase 28.1 | ✅ Complete | pkg/driver/metrics.go GaugeFunc implementation |
| MON-01 | Phase 28.2 | ✅ Complete | docs/monitoring.md command documentation |
| MON-02 | Phase 28.2 | ✅ Complete | docs/monitoring.md approach recommendations |
| MON-03 | Phase 28.2 | ✅ Complete | docs/monitoring.md metric naming conventions |
| HELM-01 | Phase 28 | ✅ Complete | deploy/helm/rds-csi-driver/Chart.yaml |
| HELM-02 | Phase 28 | ✅ Complete | values.yaml rds.* configuration section |
| HELM-03 | Phase 28 | ✅ Complete | templates/storageclass.yaml with array iteration |
| HELM-04 | Phase 28 | ✅ Complete | templates/service.yaml, templates/servicemonitor.yaml |
| HELM-05 | Phase 28 | ✅ Complete | README.md (625 lines), NOTES.txt (184 lines) |

## Quality Metrics

**Test Coverage:**
- E2E snapshot tests: 6 test scenarios, 30/30 passing (100%)
- Controller unit tests: 21 snapshot test cases, all passing
- CSI sanity tests: 65/70 total, all snapshot tests passing
- Overall code coverage: 68.6% (exceeds 65% threshold)

**Verification:**
- Phase 26 verification: 9/9 must-haves verified
- Phase 27 verification: 6/6 must-haves verified
- Phase 28.1 verification: 5/5 must-haves verified
- Phase 28.2 verification: 7/7 must-haves verified
- Phase 28 verification: 6/6 must-haves verified
- **Total: 33/33 must-haves verified (100%)**

**Documentation:**
- HARDWARE_VALIDATION.md: 1565 lines, 7 test cases with 155 executable commands
- TESTING.md: 530 lines, all test types with troubleshooting
- CAPABILITIES.md: 357 lines, peer driver comparison
- ci-cd.md: 413 lines, job templates and result interpretation
- Helm README.md: 625 lines, all configuration documented
- monitoring.md: Complete RDS health monitoring design

## Lessons Learned

1. **Tech Debt Tracking**: Milestone audit identified 3 documentation gaps that were resolved via quick tasks before completion. Early identification prevented last-minute scramble.

2. **E2E Test Investment**: Creating comprehensive E2E snapshot tests (6 scenarios) caught metadata parsing bugs (file-size, creation-time) before production deployment. Investment in test quality pays off.

3. **Research Before Implementation**: Phase 28.2 RDS monitoring research informed Phase 28 Helm chart monitoring integration. Research phases create better implementation plans.

4. **Decimal Phase Insertion**: Successfully used Phase 28.1 and 28.2 for urgent production fixes without disrupting planned roadmap sequence. Pattern proved valuable for mid-milestone discoveries.

5. **Verification Coverage**: 100% must-haves verification rate (33/33) prevented gaps from slipping through. Goal-backward verification catches implementation drift.

## Future Work (Deferred)

Based on milestone completion, the following requirements are candidates for future milestones:

1. **Production E2E Tests**: Create test/e2e/snapshot_test.go against real RDS hardware (currently runs against mock). Deferred based on production feedback about snapshot reliability.

2. **RDS Monitoring Implementation**: Phase 28.2 completed research and design. Implementation deferred to future milestone pending production feedback on metric value.

3. **Snapshot Performance Tuning**: Current implementation creates snapshots synchronously. Future work could explore async snapshot creation for large volumes.

4. **Multi-Tenant Snapshot Isolation**: Research VolumeSnapshotClass per-tenant configuration for shared RDS instances.

---

*Requirements defined: 2026-02-04*
*Requirements shipped: 2026-02-06*
*Archived: 2026-02-06*

# golangci-lint configuration for RDS CSI Driver
# Run with: make lint (or golangci-lint run)

version: "2"

run:
  tests: true
  build-tags:
    - integration

linters:
  default: none
  enable:
    # Error handling linters
    - errcheck      # Check for unchecked errors
    - errorlint     # Enforce Go 1.13+ error patterns

    # Complexity linters
    - gocyclo       # Cyclomatic complexity per function
    - cyclop        # Function and package complexity

    # Code quality linters
    - govet
    - ineffassign
    - staticcheck
    - unused

  disable:
    # Disabled intentionally
    - wrapcheck     # Too strict for this codebase - many internal errors don't need wrapping

  settings:
    errcheck:
      # Check for unchecked errors in type assertions
      check-type-assertions: true
      # Check for unchecked errors in blank assignments
      check-blank: false
      # Don't require checking Close() errors (common pattern)
      exclude-functions:
        - (io.Closer).Close
        - (*os.File).Close

    errorlint:
      # Require %w for error wrapping in fmt.Errorf
      errorf: true
      # Suggest errors.Is instead of == comparison
      comparison: true
      # Suggest errors.As instead of type assertion
      asserts: true

    gocyclo:
      # Threshold based on current baseline (max: 44 in RecordEvent)
      # Set to 50 to allow existing code, catch new violations
      # Target: Ratchet down to 30 by v0.8, 20 by v1.0
      min-complexity: 50

    cyclop:
      # Match gocyclo threshold for consistency
      max-complexity: 50

  exclusions:
    # Skip generated code
    generated: lax

    rules:
      # Allow %v in test files (test error messages don't need chains)
      - path: _test\.go
        linters:
          - errorlint
        text: "non-wrapping format verb"

      # Ignore errcheck in test files
      - path: _test\.go
        linters:
          - errcheck

      # Allow type assertions in test mocks
      - path: test/mock/
        linters:
          - errorlint
        text: "type assertion"

      # Allow dot imports in e2e tests (Ginkgo/Gomega convention)
      - path: test/e2e/
        linters:
          - staticcheck
        text: "ST1001"

issues:
  # Don't limit issues per linter
  max-issues-per-linter: 0
  max-same-issues: 0
